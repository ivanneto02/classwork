<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
<title>cs152 Project Phase 3: Code Generation</title>
</head>

<body>

<h2><u>cs152 Project Phase 3: Code Generation</u></h2>
<br>

<h3>Overview</h3>

<p>
In the previous phases of the class project, you used the <i>flex</i> and <i>bison</i>
tools to create a lexical analyzer and a parser for your programming language.
In this phase of the class project, you will take a syntactically-correct 
program (a program that can be parsed without any syntax errors), verify that it has
no semantic errors, and then generate its corresponding intermediate code.
The generated code can then be executed (using a tool we will provide)
to run the compiled program.  
</p>

<p>
[<i>The MINI-L source-code language is described in detail <a href="mini_l.html">here</a></i> (this is the same as for the prior project phases).]
</p>

<p>
You need to do code generation for the following statements:
</p>
<ul>
  <li>Function Related Statements</li>
  <li>Variable Declaration Statements</li>
  <li>Copy Statements</li>
  <li>Array Access Statements</li>
  <li>Input/Output Statements</li>
  <li>Arithmetic Operator Statements</li>
</ul>


<p>
You should perform <i>one-pass</i> code generation and directly output the generated code.
There is no need to build/traverse a syntax tree.  However, you will need to
maintain a symbol table during code generation.
</p>

<p>
The intermediate code you will generate is called "MIL" code.  We will provide you with an
interpreter called <code>mil_run</code> that can be used to execute the MIL code.
</p>

<p>
[<i>The MIL intermediate code representation is described in detail <a href="mil.html">here</a>.</i>] <br>
[<i>Here are some slides describing the MIL intermediate code along with advice on code generation <a href="slides.pdf">here</a>.</i>] <br>
[<i>Download the <code>mil_run</code> MIL interpreter <a href="mil_run">here</a>.</i>]
</p>

<p>
The output of your code generator will be a file containing the generated MIL code.
If any semantic errors are encountered by the code generator, then appropriate
error messages should be emitted and no other output should be produced.
</p>

<p>
Here is a correct implementation of Phase 3 that you can compare your code against <a href="min_c">min_c</a>.
</p>

<p>
[<i>The required output format for your code generator is described <a href="code_output_format.html">here</a>.</i>]
</p>


<hr>

<h3>The <code>mil_run</code> MIL interpreter</h3>

<p>
We are providing an interpreter for MIL intermediate code (<a href="mil_run">mil_run</a>), which can be
used to execute the MIL code generated by your code generator.  The <code>mil_run</code>
interpreter requires an input file to be specified that contains the MIL code that should be executed.  For
example, if you have MIL code contained in a file called <code>mil_code.mil</code>, then
you can execute the MIL code with the following command:
</p>

<p>
<code>mil_run mil_code.mil</code>
</p>

<p>
If the MIL code itself requires some input data, this input data can be written to a file
and then redirected to the executing MIL code.  For example, if the input values are
written to a text file called <code>input.txt</code>, then it can be passed to the
executing MIL program as follows:
</p>

<p>
<code>mil_run mil_code.mil < input.txt</code>
</p>

<p>
The <code>mil_run</code> interpreter will generate a file called <code>milRun.stat</code>
that contains some statistics about the MIL code that was just executed.  You may
ignore this file.
</p>

<p>
<code>mil_run</code> makes the following assumptions.
</p>

<ol>
<li>Each line in the MIL file contains at most one MIL instruction
<li>Each line is at most 254 characters long
<li>All variables are defined before they are used
</ol>

<p>
You must ensure that your generated MIL code meets the above three requirements.
</p>

<p>
<code>mil_run</code> is a linux executable and can be run on <i>bolt</i>.
</p>

<hr>

<h3>Detailed Requirements</h3>

The following tasks will need to be performed to complete this phase of the project.

<ol>
<li> You will need to modify your <i>bison</i> specification file from the previous
phase of the class project so that it no longer outputs the list of productions taken
during parsing.
<li> Implement the code generator.  This will most likely require some enhancements to
your <i>bison</i> specification file.  You may also want to create additional implementation
files.  The requirements for your implementation are as follows.

<ol type="a">
<li> You do not need to do anything special to handle <i>lexical</i> or <i>syntax</i> errors in this
phase of the class project.  If any lexical or syntax errors are encountered, your compiler
should emit appropriate error message(s) and terminate the same way as was done in previous phases.
<li> You need to check for <i>semantic</i> errors in the inputted MINI-L program.
During code generation, if any semantic errors are encountered, then appropriate
error messages should be emitted and no other output should be produced
(i.e., no code should be generated).
<li> If no semantic errors are encountered, then the appropriate MIL intermediate code should be
generated and written to stdout.
<li> When generating the intermediate code, be careful that you do not accidentally create a temporary
variable with the same name as one of the variables specified in the original MINI-L program.
</ol>

<li> Compile everything together into a single executable.  The particular commands
needed to compile your code generator will depend on the implementation files you
create.
<li> Use the <code>mil_run</code> MIL interpreter to test your implementation.
For each program written in MINI-L source code, compile it down to MIL code using
your implementation.  Then invoke the MIL code using <code>mil_run</code> to verify
that the compiled program behaves as expected.<br>
</ol>

<hr>

<h3>A Note about Runtime Errors</h3>

<p>
There are some errors that cannot always be captured at compile-time and may only
happen at run-time.  These errors include those such as array index out-of-bounds
errors, and division by zero.  Your implementation need not handle these errors.
You may assume that when we grade your programs, we will not use any MINI-L programs
that would lead to run-time errors.  Note also that the <code>mil_run</code> MIL interpreter
we are providing may have unexpected behavior if you try to run it on a program
that can lead to run-time problems (such as an out-of-bounds array access).
Thus, when you are testing your implementation, try to make sure your MINI-L programs
will not cause any run-time errors.
</p>

<hr>

<h3>Example Usage</h3>

<p>
Suppose your code generator is in the executable named <code>my_compiler</code>.  Then for
the MINI-L program <a href="basic.min">basic.min</a> (which is syntactically and semantically
correct), your code generator should be invoked as follows:
</p>

<p>
<code>cat basic.min | my_compiler</code>
</p>

<p>
The file <a href="basic.mil">basic.mil</a> should then be created and should contain the generated MIL code
(it is okay if your generated code looks slightly different, but it should have the same behavior when executed).
Next, you can test your generated code using the <code>mil_run</code> MIL interpreter to ensure that
it behaves as expected.  Suppose we want to run the compiled <code>array</code> program:
</p>

<code>
mil_run basic.mil
</code>

<p>
When the compiled <code>array</code> program is executed, then the following would be the output:
</p>

<code>
150
</code>

<p>
Here is the expected MIL output for <a href="add.min">add.min</a>: <a href="add.mil">add.mil</a>
</p>

<code>
mil_run add.mil
</code>

<p>
When the compiled <code>add</code> program is executed, then the following would be the output:
</p>

<code>
150
</code>

<p>
Here is the expected MIL output for <a href="math.min">math.min</a>: <a href="math.mil">math.mil</a>
</p>

<code>
mil_run math.mil
</code>

<p>
When the compiled <code>math</code> program is executed, then the following would be the output:
</p>

<code>
150
50
5000
2
0
</code>


<p>
Here is the expected MIL output for <a href="array.min">array.min</a>: <a href="array.mil">array.mil</a>
</p>

<code>
mil_run array.mil
</code>

<p>
When the compiled <code>array</code> program is executed, then the following would be the output:
</p>

<code>
8
100
200
840
</code>

<p>
Here is the expected MIL output for <a href="function.min">function.min</a>: <a href="function.mil">function.mil</a>
</p>

<code>
mil_run function.mil
</code>

<p>
When the compiled <code>function</code> program is executed, then the following would be the output:
</p>

<code>
150
22500
</code>

</body>

</html>
